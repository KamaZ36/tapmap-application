# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤

```
tests/
‚îú‚îÄ‚îÄ conftest.py                 # –û–±—â–∏–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã –¥–ª—è –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
‚îú‚îÄ‚îÄ unit/                       # Unit —Ç–µ—Å—Ç—ã (–±—ã—Å—Ç—Ä—ã–µ, –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ)
‚îÇ   ‚îú‚îÄ‚îÄ conftest.py            # –§–∏–∫—Å—Ç—É—Ä—ã –¥–ª—è unit —Ç–µ—Å—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ domain/                # –¢–µ—Å—Ç—ã –¥–æ–º–µ–Ω–Ω—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ interactions/          # –¢–µ—Å—Ç—ã –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ repositories/          # –¢–µ—Å—Ç—ã —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤ (—Å fake –æ–±—ä–µ–∫—Ç–∞–º–∏)
‚îÇ   ‚îî‚îÄ‚îÄ services/              # –¢–µ—Å—Ç—ã —Å–µ—Ä–≤–∏—Å–æ–≤
‚îî‚îÄ‚îÄ integration/                # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã (—Å —Ä–µ–∞–ª—å–Ω–æ–π –ë–î)
    ‚îú‚îÄ‚îÄ conftest.py            # –§–∏–∫—Å—Ç—É—Ä—ã –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
    ‚îî‚îÄ‚îÄ test_*.py              # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
```

## –¢–∏–ø—ã —Ç–µ—Å—Ç–æ–≤

### Unit —Ç–µ—Å—Ç—ã
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –≤ –∏–∑–æ–ª—è—Ü–∏–∏
- **–°–∫–æ—Ä–æ—Å—Ç—å**: –ë—ã—Å—Ç—Ä—ã–µ (< 1 —Å–µ–∫)
- **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**: –ò—Å–ø–æ–ª—å–∑—É—é—Ç fake –æ–±—ä–µ–∫—Ç—ã (FakeRepository, FakeTransactionManager)
- **–û–±–ª–∞—Å—Ç—å**: –î–æ–º–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞, –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞, –≤–∞–ª–∏–¥–∞—Ü–∏—è

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- **–°–∫–æ—Ä–æ—Å—Ç—å**: –°—Ä–µ–¥–Ω–∏–µ (1-10 —Å–µ–∫)
- **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**: –†–µ–∞–ª—å–Ω–∞—è —Ç–µ—Å—Ç–æ–≤–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- **–û–±–ª–∞—Å—Ç—å**: –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏, —Å–µ—Ä–≤–∏—Å—ã, API endpoints

## –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

**–í–∞–∂–Ω–æ**: –¢–µ—Å—Ç—ã –¥–æ–ª–∂–Ω—ã –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ Poetry –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏.

### –í—Å–µ —Ç–µ—Å—Ç—ã
```bash
poetry run pytest
```

### –¢–æ–ª—å–∫–æ unit —Ç–µ—Å—Ç—ã
```bash
poetry run pytest tests/unit/ -m "not integration"
```

### –¢–æ–ª—å–∫–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
```bash
poetry run pytest tests/integration/ -m integration
```

### –° –ø–æ–∫—Ä—ã—Ç–∏–µ–º
```bash
poetry run pytest --cov=app --cov-report=html
```

### –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫
```bash
poetry run pytest -n auto
```

## –§–∏–∫—Å—Ç—É—Ä—ã

### –û–±—â–∏–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã (`tests/conftest.py`)
- `sample_user` - —Ç–µ—Å—Ç–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
- `sample_driver` - —Ç–µ—Å—Ç–æ–≤—ã–π –≤–æ–¥–∏—Ç–µ–ª—å
- `sample_vehicle` - —Ç–µ—Å—Ç–æ–≤–æ–µ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–æ–µ —Å—Ä–µ–¥—Å—Ç–≤–æ
- `sample_coordinates` - —Ç–µ—Å—Ç–æ–≤—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã

### Unit —Ç–µ—Å—Ç—ã —Ñ–∏–∫—Å—Ç—É—Ä—ã (`tests/unit/conftest.py`)
- `transaction_manager` - fake transaction manager
- `user_repository` - fake —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `driver_repository` - fake —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –≤–æ–¥–∏—Ç–µ–ª–µ–π
- –ò –¥—Ä—É–≥–∏–µ fake —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã —Ñ–∏–∫—Å—Ç—É—Ä—ã (`tests/integration/conftest.py`)
- `test_engine` - —Ç–µ—Å—Ç–æ–≤–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- `test_session` - —Ç–µ—Å—Ç–æ–≤–∞—è —Å–µ—Å—Å–∏—è –ë–î

## –ú–∞—Ä–∫–µ—Ä—ã

- `@pytest.mark.unit` - unit —Ç–µ—Å—Ç—ã
- `@pytest.mark.integration` - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
- `@pytest.mark.slow` - –º–µ–¥–ª–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã

## –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

1. **–ò–º–µ–Ω–æ–≤–∞–Ω–∏–µ**: `test_*.py` –¥–ª—è —Ñ–∞–π–ª–æ–≤, `test_*` –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–π
2. **–ò–∑–æ–ª—è—Ü–∏—è**: –ö–∞–∂–¥—ã–π —Ç–µ—Å—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–º
3. **Fake –æ–±—ä–µ–∫—Ç—ã**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–ª—è –∏–∑–æ–ª—è—Ü–∏–∏ –≤ unit —Ç–µ—Å—Ç–∞—Ö
4. **–¢–µ—Å—Ç–æ–≤–∞—è –ë–î**: –û—Ç–¥–µ–ª—å–Ω–∞—è –±–∞–∑–∞ –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
5. **–§–∏–∫—Å—Ç—É—Ä—ã**: –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–±—â–∏–µ –æ–±—ä–µ–∫—Ç—ã —á–µ—Ä–µ–∑ —Ñ–∏–∫—Å—Ç—É—Ä—ã
6. **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `@pytest.mark.asyncio` –¥–ª—è async —Ç–µ—Å—Ç–æ–≤

## –ù–µ–¥–∞–≤–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã —Å —Ç–µ—Å—Ç–∞–º–∏:
- ‚úÖ **User**: –û–±–Ω–æ–≤–ª–µ–Ω—ã —Ç–µ—Å—Ç—ã –¥–ª—è –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –±–µ–∑ Unit of Work
- ‚úÖ **Driver**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã —Ç–µ—Å—Ç—ã, –¥–æ–±–∞–≤–ª–µ–Ω–æ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ `license_number`
- ‚úÖ **Vehicle**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã —Ç–µ—Å—Ç—ã, —É–±—Ä–∞–Ω–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç —Ñ–∏–∫—Å—Ç—É—Ä
- ‚úÖ **Order**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏–π –∏–º–ø–æ—Ä—Ç, –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ —Ç–µ—Å—Ç–æ–≤
- ‚úÖ **Value Objects**: –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ **City**: –¢–µ—Å—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å—é `shapely`

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:
- üîÑ –£–±—Ä–∞–Ω Unit of Work –ø–∞—Ç—Ç–µ—Ä–Ω
- üîÑ Interactions —Ç–µ–ø–µ—Ä—å –ø–æ–ª—É—á–∞—é—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –∏ transaction manager –Ω–∞–ø—Ä—è–º—É—é
- üîÑ –°–æ–∑–¥–∞–Ω `FakeTransactionManager` –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- üîÑ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏–π –∏–º–ø–æ—Ä—Ç –≤ Order
